<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>
    <body id="TODO">
        <img src="1.png" id="1" style="display: none;">
        <img src="2.png" id="2" style="display: none;">
        <img src="3.png" id="3" style="display: none;">
        <img src="4.png" id="4" style="display: none;">
        <img src="5.jpg" id="5" style="display: none;">
        <img src="6.jpg" id="6" style="display: none;">
        <img src="7.png" id="7" style="display: none;">
        <img src="8.jpg" id="8" style="display: none;">

        <canvas id="espacio" width="300" height="800"></canvas>
        <script>
            //var a = setInterval(movimiento, 1000);
            var Joc = {
                espai: null,
                estat: null,
                puntuacioJugador: 0,
                puntuacioMaxima: 0,
                nivell: 0,
                pecaVigent: null,
                seguentPeca: null,
                comptador: new Array(7),
                interval: 0,
                inicialitzarJoc: function () {
                    this.espai = [
                        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
                        [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
                    ];
                    this.estat = null;
                    this.puntuacioJugador = 0;
                    this.puntuacioMaxima = 0;
                    this.nivell = 1;
                    this.pecaVigent = 0;
                    this.seguentPeca = GeneraPecaAleatoria();
                    this.comptador["i"] = 0;
                    this.comptador["j"] = 0;
                    this.comptador["l"] = 0;
                    this.comptador["o"] = 0;
                    this.comptador["s"] = 0;
                    this.comptador["t"] = 0;
                    this.comptador["z"] = 0;
                    this.interval = 0;
                },
                introduccioTeclat: function (e) {
                    console.log(e.key);

                    if (e.key === "ArrowRight") {
                        pa.moureDreta();
                    } else if (e.key === "ArrowLeft") {
                        pa.moureEsquerra();
                    } else if (e.key === "ArrowUp") {
                        pa.rotarHorari();
                    } else if (e.key === "ArrowDown") {
                        pa.baixar();
                    }
                },
                moviment: function () {
                    // document.body.innerHTML = "";

                    if (pa.color === "lila") {
                        n = 4;
                    } else {
                        n = 3;
                    }

                    if (pa.x + n < 25) {
                        if (comprovar() === true) {
                            canviarPeca();
                        } else {
                            for (var i = 0; i < pa.forma[0].length; i++) {
                                for (var j = 0; j < pa.forma[1].length; j++) {
                                    if (pa.forma[i][j] === 1) {
                                        Joc.espai[i + pa.x][j + pa.y] = 0;
                                    }
                                }
                            }
                            pa.x++;
                        }
                    } else {
                        canviarPeca();
                    }

                    for (var i = 0; i < pa.forma[0].length; i++) {
                        for (var j = 0; j < pa.forma[1].length; j++) {
                            if (pa.forma[i][j] === 1) {
                                if (pa.color === "groc") {
                                    Joc.espai[i + pa.x][j + pa.y] = 'O';
                                } else if (pa.color === "lila") {
                                    Joc.espai[i + pa.x][j + pa.y] = 'I';
                                } else if (pa.color === "verd") {
                                    Joc.espai[i + pa.x][j + pa.y] = 'S';
                                } else if (pa.color === "roig") {
                                    Joc.espai[i + pa.x][j + pa.y] = 'Z';
                                } else if (pa.color === "blau") {
                                    Joc.espai[i + pa.x][j + pa.y] = 'L';
                                } else if (pa.color === "taronja") {
                                    Joc.espai[i + pa.x][j + pa.y] = 'J';
                                } else {
                                    Joc.espai[i + pa.x][j + pa.y] = 'T';
                                }

                            }
                        }
                    }

                    Joc.mostrar();
                },
                mostrar: function () {
                    var canvas = document.getElementById("espacio");
                    var ctx = canvas.getContext("2d");
                    var img;
                    console.log(Joc.puntuacioJugador);
//                    document.write("<br>Peça següent:<br>");
//                    for (var i = 0; i < ps.forma[0].length; i++) {
//                        for (var j = 0; j < ps.forma[1].length; j++) {
//                            document.write(ps.forma[i][j]);
//                            document.write(" ");
//                        }
//                        document.write("<br>");
//                    }
//                    document.write("<br>");
//                    document.write("<br>");
//                    document.write("Puntuacio Jugador: " + this.puntuacioJugador);
//                    document.write("<br>");
//                    document.write("Puntuacio màxima: " + this.puntuacioMaxima);
//                    document.write("<br>");
//                    document.write("Nivell: " + this.nivell);
//                    document.write("<br><br>");
//                    document.write("<table style='bg-color: black; border-collapse: collapse;'>");
                    for (var i = 0; i < this.espai.length; i++) {
                        //document.write("<tr>");
                        for (var j = 0; j < this.espai[i].length; j++) {
                            if (this.espai[i][j] === 'O') {
                                //document.write("<td style='width: px; height:15px;' bgcolor='#f4f442'></td>");
                                img = document.getElementById("1");
                            } else if (this.espai[i][j] === 'I') {
                                //document.write("<td style='width: 15px; height:15px;' bgcolor='#7d41f4'></td>");
                                img = document.getElementById("2");
                            } else if (this.espai[i][j] === 'S') {
                                //document.write("<td style='width: 15px; height:15px;' bgcolor='#41f467'></td>");
                                img = document.getElementById("3");
                            } else if (this.espai[i][j] === 'Z') {
                                //document.write("<td style='width: 15px; height:15px;' bgcolor='#f44141'></td>");
                                img = document.getElementById("4");
                            } else if (this.espai[i][j] === 'L') {
                                //document.write("<td style='width: 15px; height:15px;' bgcolor='#41c1f4'></td>");
                                img = document.getElementById("5");
                            } else if (this.espai[i][j] === 'J') {
                                //document.write("<td style='width: 15px; height:15px;' bgcolor='#f49a41'></td>");
                                img = document.getElementById("6");
                            } else if (this.espai[i][j] === 'T') {
                                //document.write("<td style='width: 15px; height:15px;' bgcolor='#4c41f4'></td>");
                                img = document.getElementById("7");
                            } else {
                                //document.write("<td style='width: 20px; height:20px;' bgcolor='#727272'></td>");
                                img = document.getElementById("8");
                            }
                            ctx.drawImage(img, j * 25, i * 25, 25, 25);
//                            document.write(this.espai[i][j]);
//                            document.write(" ");
                        }
                        //document.write("</tr>");
                    }
                    //document.write("</table>");
                }
            };
            var Objecte = function (forma, color) {
                this.forma = forma;
                this.color = color;
                this.x = 0;
                this.y = 3;
            };
            Objecte.prototype.rotarHorari = function () {
                var formaNova = new Array();
                limpiar();
                for (var i = 0; i < this.forma.length; i++) {
                    formaNova[i] = new Array();
                    for (var j = 0; j < this.forma[i].length; j++) {
                        formaNova[i][j] = this.forma[this.forma[i].length - 1 - j][i];
                    }
                }
                this.forma = formaNova;
            };
            Objecte.prototype.rotarAntihorari = function () {
                for (var i = 0; i < 3; i++) {
                    var formaNova = new Array();
                    for (var i = 0; i < this.forma.length; i++) {
                        formaNova[i] = new Array();
                        for (var j = 0; j < this.forma[i].length; j++) {
                            formaNova[i][j] = this.forma[this.forma[i].length - 1 - j][i];
                        }
                    }
                    this.forma = formaNova;
                }
            };
            Objecte.prototype.baixar = function () {
                Joc.puntuacioJugador++;
                Joc.moviment();
            };
            Objecte.prototype.moureDreta = function () {
                if ((comprovarDreta() + pa.y) < 10) {
                    limpiar();
                    pa.y++;
                }
            };
            Objecte.prototype.moureEsquerra = function () {
                if ((comprovarEsquerra() + pa.y) > 0) {
                    limpiar();
                    pa.y--;
                }
            };
            Objecte.prototype.retornarPeca = function () {
                return this.forma;
            };

            function GeneraPecaAleatoria() {
                var peces = [
                    [[[0, 0, 0, 0], [0, 1, 1, 0], [0, 1, 1, 0], [0, 0, 0, 0]], "groc"],
                    [[[0, 1, 0, 0], [0, 1, 0, 0], [0, 1, 0, 0], [0, 1, 0, 0]], "lila"],
                    [[[0, 0, 0, 0], [0, 1, 1, 0], [1, 1, 0, 0], [0, 0, 0, 0]], "verd"],
                    [[[0, 0, 0, 0], [0, 1, 1, 0], [0, 0, 1, 1], [0, 0, 0, 0]], "roig"],
                    [[[0, 1, 0, 0], [0, 1, 0, 0], [0, 1, 1, 0], [0, 0, 0, 0]], "blau"],
                    [[[0, 1, 1, 0], [0, 1, 0, 0], [0, 1, 0, 0], [0, 0, 0, 0]], "taronja"],
                    [[[0, 0, 0, 0], [1, 1, 1, 0], [0, 1, 0, 0], [0, 0, 0, 0]], "morat"]];
                var numeroAleatori = Math.round(Math.random() * 6);
                return peces[numeroAleatori];
            }

            function limpiar() {
                for (var i = 0; i < pa.forma[0].length; i++) {
                    for (var j = 0; j < pa.forma[1].length; j++) {
                        if (pa.forma[i][j] === 1) {
                            Joc.espai[i + pa.x][j + pa.y] = 0;
                        }
                    }
                }
            }

            function comprovar() {
                bool = false;

                for (var i = 0; i < pa.forma[0].length; i++) {
                    for (var j = 0; j < pa.forma[1].length; j++) {
                        if (pa.forma[i][j] === 1) {
                            if (i < 3) {
                                if (pa.forma[i + 1][j] === 0) {
                                    if (Joc.espai[(i + pa.x) + 1][j + pa.y] !== 0) {
                                        bool = true;
                                    }
                                }
                            } else {
                                if (Joc.espai[(i + pa.x) + 1][j + pa.y] !== 0) {
                                    bool = true;
                                }
                            }
                        }
                    }
                }
                return bool;
            }

            function comprovarDreta() {
                for (var i = 0; i < pa.forma[3].length; i++) {
                    if (pa.forma[i][3] === 1) {
                        return 4;
                    }
                }
                for (var i = 0; i < pa.forma[2].length; i++) {
                    if (pa.forma[i][2] === 1) {
                        return 3;
                    }
                }
                for (var i = 0; i < pa.forma[1].length; i++) {
                    if (pa.forma[i][1] === 1) {
                        return 2;
                    }
                }
            }

            function comprovarEsquerra() {
                for (var i = 0; i < pa.forma[0].length; i++) {
                    if (pa.forma[i][0] === 1) {
                        return 0;
                    }
                }
                for (var i = 0; i < pa.forma[1].length; i++) {
                    if (pa.forma[i][1] === 1) {
                        return 1;
                    }
                }
                for (var i = 0; i < pa.forma[2].length; i++) {
                    if (pa.forma[i][2] === 1) {
                        return 2;
                    }
                }
            }

            function canviarPeca() {
                pa.forma = ps.forma;
                pa.color = ps.color;
                pa.x = 0;
                pa.y = 3;
                Joc.seguentPeca = GeneraPecaAleatoria();
                ps.forma = Joc.seguentPeca[0];
                ps.color = Joc.seguentPeca[1];
                ps.x = 0;
                ps.y = 3;
            }

            Joc.inicialitzarJoc();
            var peca = new Array();
            peca = GeneraPecaAleatoria();
            pa = new Objecte(peca[0], peca[1]);
            Joc.pecaVigent = pa;
            ps = new Objecte(Joc.seguentPeca[0], Joc.seguentPeca[1]);
            a = setInterval(Joc.moviment, 250);

            var element = document.getElementById("TODO");
            element.addEventListener("keydown", Joc.introduccioTeclat);
            console.log(element);
        </script>
    </body>
</html>